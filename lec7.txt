LIBNAME ACX "";
OPTION ERROR=3;

/*1.winsorize data*/
*construct variables and delete missing values;
DATA ROE; SET ACX.ROE;
ROE=NI/CEQ;
PM=NI/SALE;
ATO=SALE/AT;
LEV=AT/CEQ;

ARRAY M(*) ROE PM ATO LEV;
DO I=1 TO HBOUD(M);
IF M(i)=. THEN DELETE;
END;
KEEP GVKEY DATADATE FYEAR SICI ROE PM ATO LEV;
RUN;

PROC MEANS DATA=ROW;
VAR ROE PM ATO LEV;
RUN;

/*2*/
PROC SORT DATA=ROE; BY FYEAR;
PROC MEANS DATA=ROE NOPRINT; BY FYEAR;
VAR ROE PM ATO LEV;
OUTPUT OUT=OUT1 P1=L_ROE L_PM L_ATO L_LEV 
		   P99=H_ROE H_PM H_ATO H_LEV ;
RUN;

DATA ROE1; MERGE ROE OUT1 (DROP=_TYPE_ _FREQ_); BY FYEAR;
IF ROE<L_ROE THEN ROE=L_ROE; IF ROE>H_ROE THEN ROE=H_ROE;
IF PM<L_PM THEN PM=L_PM; IF PM>H_PM THEN PM=H_PM;
IF ATO<L_ATO THEN ATO=L_ATO; IF ATO>H_ATO THEN ATO=H_ATO;
IF LEV<L_LEV THEN LEV=L_LEV; IF LEV>H_LEV THEN LEV=H_LEV;
DROP L_ROE L_PM L_ATO L_LEV H_ROE H_PM H_ATO H_LEV;
RUN; 
PROC MEANS DATA=ROE1; 
VAR ROE PM ATO LEV;
RUN;
