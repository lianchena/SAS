PROC CORR DATA= "C:\SASDATA \SOMEDATA";
VAR AGE TIMEl TIME2;
RUN;
PROC CORR DATA= "C:\SASDATA\SOMEDATA";
     VAR TIMEl-TIME4;
     WITH AGE;
RUN;

PROC REG;
MODEL JOBSCORE=TESTl TEST2 TEST3 TEST4;
TITLE 'Job Score Analysis using PROC REG';
RUN;
QUIT;

/*step one, ROE=PM x ATO x LEV*/
DATA ROE; SET ACX.ROE;
ROE=NI/CEQ ;
PM=NI/SALE;
ATO=SALE/AT;
LEV=AT/CEQ;
SIC1=INT(SIC/1000);
*IF ROE NE . AND PM NE . AND ATO NE . AND LEV NE . ;
ARRAY M(*) ROE PM ATO LEV ;
DO I=1 TO HBOUND(M);
IF M(i)=. THEN DELETE;
END;
KEEP GVKEY DATADATE FYEAR SIC1 ROE PM ATO LEV;
RUN;

/*step two*/
* WINSORIZE THE VARIABLES *;
PROC SORT DATA=ROE; BY FYEAR;
PROC MEANS DATA=ROE NOPRINT; BY FYEAR;
VAR ROE PM ATO LEV;
OUTPUT OUT=OUT1 P1=L_ROE L_PM L_ATO L_LEV 
		   P99=H_ROE H_PM H_ATO H_LEV ;
RUN;
DATA ROE1; MERGE ROE OUT1 (DROP=_TYPE_ _FREQ_); BY FYEAR;
IF ROE<L_ROE THEN ROE=L_ROE; IF ROE>H_ROE THEN ROE=H_ROE;
IF PM<L_PM THEN PM=L_PM; IF PM>H_PM THEN PM=H_PM;
IF ATO<L_ATO THEN ATO=L_ATO; IF ATO>H_ATO THEN ATO=H_ATO;
IF LEV<L_LEV THEN LEV=L_LEV; IF LEV>H_LEV THEN LEV=H_LEV;
DROP L_ROE L_PM L_ATO L_LEV H_ROE H_PM H_ATO H_LEV;
RUN; 
PROC MEANS DATA=ROE1; 
VAR ROE PM ATO LEV;
RUN;

* MAKE SAS MACRO TO DO WINSORIZING *;
%MACRO WIN_1PCT (DATA, SORT, N, VAR);
PROC SORT DATA=&DATA; BY &SORT;
PROC MEANS DATA=&DATA NOPRINT; BY &SORT;
VAR &VAR;
OUTPUT OUT=STAT (DROP=_TYPE_ _FREQ_)
P1=L1-L&N
P99=H1-H&N ;
RUN;
DATA NEW&DATA; MERGE &DATA STAT; BY &SORT;
ARRAY V(*) &VAR;
ARRAY H(*) H1-H&N;
ARRAY L(*) L1-L&N;
DO I=1 TO &N;
IF .<V(I)<L(I) THEN V(I)=L(I);
IF V(I)>H(I) THEN V(I)=H(I);
END;
DROP I H1-H&N L1-L&N;
PROC MEANS DATA=NEW&DATA; 
VAR &VAR; 
RUN;
%MEND;
%WIN_1PCT (DATA=ROE, SORT=FYEAR, N=4, VAR=ROE PM ATO LEV); RUN;


/*step three*/
PROC CORR DATA=ROE1;
VAR ROE PM ATO LEV;
RUN;

PROC CORR DATA=ROE1 SPEARMAN;
VAR ROE PM ATO LEV;
RUN;

PROC REG DATA=ROE1; 
MODEL ROE=PM ATO LEV;
RUN;
PROC REG DATA=ROE1; 
WHERE PM>0;
MODEL ROE=PM ATO LEV;
RUN;
PROC REG DATA=ROE1; 
WHERE PM<0;
MODEL ROE=PM ATO LEV;
RUN;

/*step4 four*/
PROC SORT DATA=ROE1; BY SIC1;
PROC REG DATA=ROE1 NOPRINT OUTEST=OUT2 RSQUARE;
BY SIC1;
WHERE PM>0;
MODEL ROE=PM ATO LEV;
RUN;
PROC PRINT DATA=OUT2;
VAR SIC1 INTERCEPT PM ATO LEV _RSQ_ ;
RUN;

