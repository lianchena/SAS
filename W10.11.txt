/*W10*/
DATA EPS; SET ACX.EPS; WHERE EPS NE . ;
IF EPS < 0 THEN LOSS = 1 ;
ELSE LOSS = 0;
RUN;
PROC SORT DATA = EPS; BY GVKEY FYEAR ; RUN;
DATA EPS1; SET EPS;
GVKEY1 = LAG(GVKEY); LOSS1 = LAG(LOSS); FYEAR1 = LAG(FYEAR);
IF GVKEY = GVKEY1 AND FYEAR = (FYEAR1+1) THEN LOSS1 = LOSS1; 
ELSE LOSS1 = .;
RUN;
PROC PRINT DATA = EPS1 (OBS = 50) ; RUN;

PROC REG DATA=EPS1;
MODEL LOSS = LOSS1;
RUN;

PROC LOGISTIC DATA=EPS1; 
MODEL LOSS (EVENT="1") = LOSS1;
OUTPUT OUT=OUT1 P=PREDICT ;
RUN;
PROC PRINT DATA=OUT1 (OBS=20);
VAR GVKEY FYEAR LOSS LOSS1 PREDICT;
RUN;
DATA OUT2; SET OUT1; WHERE PREDICT NE . ;
IF PREDICT >= 0.7 THEN P_LOSS=1; 
ELSE P_LOSS = 0 ;
RUN;
PROC FREQ DATA=OUT2;
TABLE P_LOSS * LOSS;
RUN;










/*W11*/
PROC LOGISTIC DATA=EPS1 DESCENDING;
MODEL LOSS = LOSS1 / OUTROC=ROC1;
OUTPUT OUT=OUT3 P=P1;
QUIT;
PROC LOGISTIC DATA=EPS1 DESCENDING;
MODEL LOSS = LOSS1 / CTABLE PPROB=(0.1, 0.5 TO 0.8 BY 0.1) ;
OUTPUT OUT=OUT3 P=P1;
QUIT;
PROC LOGISTIC DATA=HEART DESCENDING;
MODEL DEATH = MALE AGEATSTART SMOKING SYSTOLIC CHOLESTEROL WEIGHT / OUTROC=ROC2 ;
QUIT;

TITLE "SENSITIVITY AND 1-SPECIFICITY AT DIFFERENT PREDICTED PROBABILITY" ;
PROC SGPLOT DATA=ROC2;
SERIES X=_PROB_ Y=_SENSIT_;
SERIES X=_PROB_ Y=_1MSPEC_;
RUN;
PROC LOGISTIC DATA=HEART DESCENDING;
MODEL DEATH = MALE AGEATSTART SMOKING SYSTOLIC CHOLESTEROL WEIGHT / SELECTION = STEPWISE OUTROC=ROC2 ;
QUIT;
PROC LOGISTIC DATA=HEART DESCENDING;
MODEL DEATH = MALE AGEATSTART SMOKING SYSTOLIC CHOLESTEROL / CTABLE PPROB=(0.1 to 1 by 0.1) ;
QUIT;

